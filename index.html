<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ§åˆ¶ Unity</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 375px;
  height: 667px;
  overflow: hidden;
  position: relative;
  background: url('assets/bg.png') no-repeat top left;
  background-size: 100% 100%;
}

/* å½±ç‰‡ */
#grassVideo {
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: auto;
  display: none;
  z-index: 1;
}

/* è‰åœ°è¦†è“‹ */
.grass-overlay {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  z-index: 2;
  pointer-events: none;
}

/* æŒ‰éˆ• */
#button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 120px;
  z-index: 3;
  cursor: pointer;
  touch-action: manipulation;
}

/* é€²åº¦æ¢ */
.progress-container {
  position: absolute;
  top: calc(50% + 70px);
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 12px;
  background: #ccc;
  border-radius: 6px;
  overflow: hidden;
  z-index: 3;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: #4caf50;
}
</style>
</head>

<body>

<!-- å½±ç‰‡ -->
<video id="grassVideo" muted playsinline>
  <source src="assets/grass.webm" type="video/webm">
  <source src="assets/grass.mp4" type="video/mp4">
</video>

<!-- è‰åœ° -->
<img src="assets/grass_overlay.png" class="grass-overlay">

<!-- æŒ‰éˆ• -->
<img id="button" src="assets/button.png">

<!-- é€²åº¦æ¢ -->
<div class="progress-container">
  <div class="progress-bar" id="progress"></div>
</div>

<script>
const btn = document.getElementById('button');
const video = document.getElementById('grassVideo');
const overlay = document.querySelector('.grass-overlay');
const progressBar = document.getElementById('progress');

let clickCount = 0;
const requiredClicks = 10;
const clickTimeout = 1000;
let timer = null;
let activated = false;

/* Unity é€šçŸ¥ */
function sendToUnity() {
  fetch("http://192.168.50.128:8080/")
    .then(() => console.log("å·²é€å‡ºçµ¦ Unity"))
    .catch(err => console.log(err));
}

/* å½±ç‰‡ä½ç½®ï¼šè‰åœ°ä¸€åŠ */
function positionVideo() {
  const overlayHeight = overlay.offsetHeight;
  video.style.bottom = (overlayHeight / 2) + 'px';
}

window.addEventListener('load', positionVideo);
window.addEventListener('resize', positionVideo);

function handleClick(e) {
  e.preventDefault();
  if (activated) return;

  if (timer) clearTimeout(timer);

  clickCount++;
  progressBar.style.width =
    Math.min((clickCount / requiredClicks) * 100, 100) + '%';

  if (clickCount >= requiredClicks) {
    activated = true;

    video.style.display = 'block';
    video.load();
    video.play().catch(()=>{});

    progressBar.style.width = '100%';

    // ğŸ‘‰ é€šçŸ¥ Unityï¼ˆåªé€ä¸€æ¬¡ï¼‰
    sendToUnity();

    // åœåœ¨æœ€å¾Œä¸€æ ¼
    video.addEventListener('ended', () => {
      video.pause();
      video.currentTime = video.duration;
    });

    return;
  }

  timer = setTimeout(() => {
    clickCount = 0;
    progressBar.style.width = '0%';
  }, clickTimeout);
}

btn.addEventListener('touchend', handleClick, false);
btn.addEventListener('click', handleClick, false);
</script>

</body>
</html>
